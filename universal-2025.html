<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Universal Studios Hollywood Planner & Tracker</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700&display=swap');
        body { font-family: 'Inter', sans-serif; }
        
        /* Card Shine Effect */
        .card-shine { position: relative; overflow: hidden; }
        .card-shine::after {
            content: ""; position: absolute; top: -50%; left: -50%; width: 200%; height: 200%;
            background: linear-gradient(to bottom right, rgba(255,255,255,0) 0%, rgba(255,255,255,0.1) 40%, rgba(255,255,255,0) 100%);
            transform: rotate(30deg); transition: transform 0.5s; pointer-events: none;
        }
        .card-shine:hover::after { transform: rotate(30deg) translate(10%, 10%); }

        /* Golden Shimmer for Potter Tab */
        @keyframes goldenShimmer {
            0% { background-position: -200% center; }
            100% { background-position: 200% center; }
        }
        .shimmer-gold {
            background: linear-gradient(120deg, rgba(30, 41, 59, 0.5) 30%, rgba(251, 191, 36, 0.2) 40%, rgba(30, 41, 59, 0.5) 50%);
            background-size: 200% auto;
            animation: goldenShimmer 4s linear infinite;
        }

        /* Utilities */
        .animate-fadeIn { animation: fadeIn 0.3s ease-out forwards; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
        
        .custom-scroll::-webkit-scrollbar { width: 6px; }
        .custom-scroll::-webkit-scrollbar-track { background: rgba(30, 41, 59, 0.5); }
        .custom-scroll::-webkit-scrollbar-thumb { background: rgba(71, 85, 105, 0.8); border-radius: 10px; }

        .checkbox-wrapper input:checked + div { background-color: #3b82f6; border-color: #3b82f6; }
        .checkbox-wrapper input:checked + div svg { display: block; }
        
        /* Date States */
        .selected-date { ring: 2px solid #60a5fa; ring-offset: 2px; ring-offset-color: #0f172a; transform: scale(1.02); }
        .inspected-date { border-color: white !important; box-shadow: 0 0 10px rgba(255,255,255,0.2); }
    </style>
</head>
<body class="bg-slate-900 text-slate-100 min-h-screen p-4 md:p-8">

    <div class="max-w-7xl mx-auto">
        
        <!-- Header -->
        <header class="mb-8 text-center relative">
            <h1 class="text-3xl md:text-4xl font-bold bg-clip-text text-transparent bg-gradient-to-r from-blue-400 to-purple-400 mb-2">
                Universal Studios Hollywood Planner
            </h1>
            <p class="text-slate-400">Dec 20, 2025 ‚Äî Jan 5, 2026</p>
            
            <div id="share-toast" class="fixed top-4 left-1/2 transform -translate-x-1/2 bg-green-600 text-white px-6 py-2 rounded-full shadow-lg opacity-0 transition-opacity pointer-events-none z-50 flex items-center gap-2 text-sm font-semibold">
                <i data-lucide="check" class="w-4 h-4"></i> Plan URL Copied!
            </div>
        </header>

        <!-- Main Grid -->
        <div class="grid grid-cols-1 lg:grid-cols-12 gap-8">
            
            <!-- Left Column: Heatmap & Intel (8 cols) -->
            <div class="lg:col-span-8 space-y-6">
                
                <!-- Heatmap Section -->
                <div class="bg-slate-800/50 rounded-2xl p-6 border border-slate-700 backdrop-blur-sm">
                    <div class="flex justify-between items-center mb-4">
                        <h2 class="text-xl font-semibold flex items-center gap-2">
                            <i data-lucide="calendar-days" class="w-5 h-5 text-blue-400"></i>
                            Select Your Trip Dates
                        </h2>
                        <div class="flex gap-2 text-xs">
                            <span class="px-2 py-1 rounded bg-green-900/50 text-green-200 border border-green-800">Lower</span>
                            <span class="px-2 py-1 rounded bg-orange-900/50 text-orange-200 border border-orange-800">Busy</span>
                            <span class="px-2 py-1 rounded bg-red-900/50 text-red-200 border border-red-800">Peak</span>
                        </div>
                    </div>
                    <div class="grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 gap-3" id="calendar-grid">
                        <!-- Generated by JS -->
                    </div>
                    <p class="text-xs text-slate-500 mt-3 text-center italic">Click a date to inspect details. Use "Add to Itinerary" to save.</p>
                </div>

                <!-- Tabs Container -->
                <div class="bg-slate-800/50 rounded-2xl border border-slate-700 overflow-hidden">
                    <div class="flex border-b border-slate-700 overflow-x-auto">
                        <!-- Wizarding World Tab (First & Shimmering) -->
                        <button onclick="switchTab('potter')" id="tab-potter" class="flex-1 py-3 px-4 text-sm font-bold bg-slate-700/50 text-amber-400 border-b-2 border-amber-500 transition-all whitespace-nowrap flex items-center justify-center gap-2 shimmer-gold">
                            <i data-lucide="wand" class="w-4 h-4"></i> Wizarding World
                        </button>
                        <button onclick="switchTab('driving')" id="tab-driving" class="flex-1 py-3 px-4 text-sm font-semibold text-slate-400 hover:text-slate-200 transition-colors whitespace-nowrap flex items-center justify-center gap-2">
                            <i data-lucide="car" class="w-4 h-4"></i> Driving
                        </button>
                        <button onclick="switchTab('events')" id="tab-events" class="flex-1 py-3 px-4 text-sm font-semibold text-slate-400 hover:text-slate-200 transition-colors whitespace-nowrap flex items-center justify-center gap-2">
                            <i data-lucide="party-popper" class="w-4 h-4"></i> Events
                        </button>
                    </div>
                    
                    <div class="p-6 min-h-[250px]">
                        
                        <!-- Potter Content (Default) -->
                        <div id="content-potter" class="animate-fadeIn">
                            <div class="flex justify-between items-start mb-4">
                                <h2 class="text-lg font-semibold flex items-center gap-2 text-amber-400">
                                    <i data-lucide="sparkles" class="w-5 h-5"></i>
                                    Potterhead Holiday Guide
                                </h2>
                                <span class="text-xs bg-amber-900/40 text-amber-200 px-2 py-1 rounded border border-amber-800">Daughter's Must-Do List</span>
                            </div>
                            <div class="grid md:grid-cols-2 gap-4 text-sm">
                                <div class="space-y-3">
                                    <div class="bg-slate-900/60 p-3 rounded border border-slate-600">
                                        <strong class="text-white block mb-1">üè∞ Castle Light Show</strong>
                                        <p class="text-slate-400">"The Magic of Christmas at Hogwarts" runs from dusk (~5:30 PM) every 30 mins. <span class="text-amber-300">Pro Tip:</span> Skip the first show. Watch the 3rd one (around 6:30/7:00) for half the crowd.</p>
                                    </div>
                                    <div class="bg-slate-900/60 p-3 rounded border border-slate-600">
                                        <strong class="text-white block mb-1">üßô‚Äç‚ôÄÔ∏è Ollivanders Wand Ceremony</strong>
                                        <p class="text-slate-400">Best chance to be "chosen"? Go first thing (8:00-8:30 AM) or very late (after 8:00 PM). Mid-day lines are 60+ mins.</p>
                                    </div>
                                </div>
                                <div class="space-y-3">
                                    <div class="bg-slate-900/60 p-3 rounded border border-slate-600">
                                        <strong class="text-white block mb-1">üç∫ Secret Souvenir: Owl Post</strong>
                                        <p class="text-slate-400">Buy a postcard at the Owl Post shop (next to Ollivanders). You can mail it from there and it gets an <span class="text-amber-300">exclusive "Hogsmeade" postmark</span> stamped on it.</p>
                                    </div>
                                    <div class="bg-slate-900/60 p-3 rounded border border-slate-600">
                                        <strong class="text-white block mb-1">üçΩÔ∏è Holiday Food Exclusives</strong>
                                        <p class="text-slate-400">‚Ä¢ Hot Butterbeer (Winter only)<br>‚Ä¢ Holiday Feast at Three Broomsticks<br>‚Ä¢ Frog Choir Holiday Carols</p>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Driving Content -->
                        <div id="content-driving" class="hidden animate-fadeIn">
                            <h2 class="text-lg font-semibold mb-3 flex items-center gap-2">
                                <i data-lucide="car" class="w-5 h-5 text-blue-400"></i>
                                NorCal to SoCal Logistics
                            </h2>
                            <div class="grid md:grid-cols-2 gap-4 text-sm text-slate-300">
                                <div class="bg-slate-900/40 p-3 rounded border border-slate-600">
                                    <strong class="text-yellow-400 block mb-1">‚ö†Ô∏è The Grapevine (I-5)</strong>
                                    Late Dec/Jan storms can close the pass (4,100ft). If "Chains Required" or closed, detour to US-101 adds 4 hours.
                                </div>
                                <div class="bg-slate-900/40 p-3 rounded border border-slate-600">
                                    <strong class="text-green-400 block mb-1">‚úÖ Best Drive Windows</strong>
                                    <ul class="list-disc list-inside opacity-90">
                                        <li>Southbound: Dec 20 (Early AM)</li>
                                        <li>Northbound: Jan 5 (Anytime - Traffic cleared)</li>
                                    </ul>
                                </div>
                            </div>
                        </div>

                        <!-- Events Content -->
                        <div id="content-events" class="hidden animate-fadeIn">
                            <h2 class="text-lg font-semibold mb-3 flex items-center gap-2">
                                <i data-lucide="party-popper" class="w-5 h-5 text-purple-400"></i>
                                What's Happening
                            </h2>
                            <div class="space-y-3 text-sm text-slate-300">
                                <div class="flex gap-3">
                                    <div class="w-1 h-full bg-red-500 rounded-full"></div>
                                    <div>
                                        <strong class="text-white">Grinchmas & Holiday Magic</strong>
                                        <p>Runs daily until <span class="text-red-300 font-bold">Jan 4th</span>. This includes the Tree Lighting, Castle Light Show, and Snowfall. Jan 5th is the first day WITHOUT these events.</p>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Right Column: Inspector & Itinerary (4 cols) -->
            <div class="lg:col-span-4 space-y-6 flex flex-col">
                
                <!-- Panel 1: Day Inspector -->
                <div id="details-panel" class="bg-slate-800 rounded-2xl p-6 border border-slate-700 shadow-xl transition-all duration-300 flex flex-col">
                    <div class="text-center text-slate-400 py-8">
                        <i data-lucide="mouse-pointer-click" class="w-12 h-12 mx-auto mb-3 opacity-50"></i>
                        <p>Click a date on the left to view details.</p>
                    </div>
                </div>

                <!-- Panel 2: My Itinerary -->
                <div class="bg-slate-800/80 rounded-2xl p-6 border border-slate-700 shadow-xl flex-grow">
                    <div class="flex justify-between items-center mb-4">
                        <h2 class="text-lg font-bold flex items-center gap-2 text-green-400">
                            <i data-lucide="map" class="w-5 h-5"></i>
                            My Itinerary
                        </h2>
                        <button onclick="copyShareLink()" class="flex items-center gap-1.5 bg-slate-700 hover:bg-slate-600 text-white px-3 py-1.5 rounded-lg transition-colors border border-slate-600 text-xs font-medium">
                            <i data-lucide="share-2" class="w-3.5 h-3.5"></i> Share
                        </button>
                    </div>
                    
                    <!-- Itinerary List Container -->
                    <div id="itinerary-list" class="space-y-4 max-h-[400px] overflow-y-auto custom-scroll pr-2">
                        <div class="text-center text-slate-500 text-sm py-4 italic">
                            No dates selected.<br>Inspect a date and click "Add" to start planning.
                        </div>
                    </div>
                </div>

            </div>

        </div>
    </div>

    <script>
        // --- Internal Icon System ---
        const iconSvgs = {
            'calendar-days': '<rect width="18" height="18" x="3" y="4" rx="2" ry="2"/><line x1="16" x2="16" y1="2" y2="6"/><line x1="8" x2="8" y1="2" y2="6"/><line x1="3" x2="21" y1="10" y2="10"/><path d="M8 14h.01"/><path d="M12 14h.01"/><path d="M16 14h.01"/><path d="M8 18h.01"/><path d="M12 18h.01"/><path d="M16 18h.01"/>',
            'car': '<path d="M19 17h2c.6 0 1-.4 1-1v-3c0-.9-.7-1.7-1.5-1.9C18.7 10.6 16 10 16 10s-1.3-1.4-2.2-2.3c-.5-.4-1.1-.7-1.8-.7H5c-.6 0-1.1.4-1.4.9l-1.4 2.9A3.7 3.7 0 0 0 2 12v4c0 .6.4 1 1 1h2"/><circle cx="7" cy="17" r="2"/><path d="M9 17h6"/><circle cx="17" cy="17" r="2"/>',
            'party-popper': '<path d="M5.8 11.3 2 22l10.7-3.79"/><path d="M4 3h.01"/><path d="M22 8h.01"/><path d="M15 2h.01"/><path d="M22 20h.01"/><path d="m22 2-2.24.75a2.9 2.9 0 0 0-1.96 3.12v0c.1.86-.57 1.63-1.45 1.63h-.38c-.86 0-1.6.6-1.76 1.44L14 10"/><path d="m22 13-.82-.33c-.86-.34-1.82.2-1.98 1.11v0c-.11.7-.72 1.22-1.43 1.22H17"/><path d="m11 2 .33.82c.34.86-.2 1.82-1.11 1.98v0C9.52 4.9 9 5.52 9 6.23V7"/><path d="M11 13c1.93 1.93 2.83 4.17 2 5-.83.83-3.07-.07-5-2-1.93-1.93-2.83-4.17-2-5 .83-.83 3.07.07 5 2Z"/>',
            'clock': '<circle cx="12" cy="12" r="10"/><polyline points="12 6 12 12 16 14"/>',
            'mouse-pointer-click': '<path d="m12 12-8-8"/><path d="m4 4 7.07 16.97 2.51-7.39 7.39-2.51L4 4z"/>',
            'alert-octagon': '<polygon points="7.86 2 16.14 2 22 7.86 22 16.14 16.14 22 7.86 22 2 16.14 2 7.86 7.86 2"/><line x1="12" x2="12" y1="8" y2="12"/><line x1="12" x2="12.01" y1="16" y2="16"/>',
            'check-circle-2': '<circle cx="12" cy="12" r="10"/><path d="m9 12 2 2 4-4"/>',
            'wand': '<path d="M15 4V2"/><path d="M15 16v-2"/><path d="M8 9h2"/><path d="M20 9h2"/><path d="M17.8 11.8 19 13"/><path d="M15 9h0"/><path d="M17.8 6.2 19 5"/><path d="m3 21 9-9"/><path d="M12.2 6.2 11 5"/>',
            'sparkles': '<path d="m12 3-1.912 5.813a2 2 0 0 1-1.275 1.275L3 12l5.813 1.912a2 2 0 0 1 1.275 1.275L12 21l1.912-5.813a2 2 0 0 1 1.275-1.275L12 3Z"/><path d="M5 3v4"/><path d="M9 3v4"/><path d="M3 5h4"/><path d="M3 9h4"/>',
            'map': '<path d="M3 6v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2V6l-7 3-9-3Z"/><path d="M3 6 12 3 21 6"/><path d="M12 3v16"/>',
            'share-2': '<circle cx="18" cy="5" r="3"/><circle cx="6" cy="12" r="3"/><circle cx="18" cy="19" r="3"/><line x1="8.59" x2="15.42" y1="13.51" y2="17.49"/><line x1="15.41" x2="8.59" y1="6.51" y2="10.49"/>',
            'check': '<polyline points="20 6 9 17 4 12"/>',
            'plus': '<line x1="12" y1="5" x2="12" y2="19"/><line x1="5" y1="12" x2="19" y2="12"/>',
            'trash': '<polyline points="3 6 5 6 21 6"/><path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"/>'
        };

        function renderIcons() {
            document.querySelectorAll('[data-lucide]').forEach(el => {
                const iconName = el.getAttribute('data-lucide');
                if (iconSvgs[iconName]) {
                    el.innerHTML = `<svg xmlns="http://www.w3.org/2000/svg" width="100%" height="100%" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">${iconSvgs[iconName]}</svg>`;
                }
            });
        }

        // Data Source
        const calendarData = [
            { date: "Dec 20", day: "Sat", score: 8, color: "bg-orange-600", text: "Busy", hours: "8am - 10pm", notes: "Passholder blockouts begin. Good balance of holiday vibes vs crowd size." },
            { date: "Dec 21", day: "Sun", score: 8, color: "bg-orange-600", text: "Busy", hours: "8am - 10pm", notes: "Often slightly lighter than Saturday. Excellent arrival day." },
            { date: "Dec 22", day: "Mon", score: 9, color: "bg-orange-700", text: "Very Busy", hours: "8am - 10pm", notes: "Crowds swell as Christmas week vacations begin." },
            { date: "Dec 23", day: "Tue", score: 9, color: "bg-orange-700", text: "Very Busy", hours: "8am - 10pm", notes: "Heavy crowds. Lower Lot (Jurassic/Mario) recommended at opening." },
            { date: "Dec 24", day: "Wed", score: 8, color: "bg-orange-600", text: "Busy", hours: "8am - 6pm", notes: "Christmas Eve. Evening crowds often thin out for dinners." },
            { date: "Dec 25", day: "Thu", score: 10, color: "bg-red-600", text: "Peak", hours: "9am - 10pm", notes: "Christmas Day. Dining reservations critical. 100+ min waits." },
            { date: "Dec 26", day: "Fri", score: 10, color: "bg-red-700", text: "Max Cap", hours: "8am - 10pm", notes: "Busiest week of the year begins. Express Pass strongly advised." },
            { date: "Dec 27", day: "Sat", score: 10, color: "bg-red-700", text: "Max Cap", hours: "8am - 10pm", notes: "Gridlock. Mario Kart capacity likely reached early." },
            { date: "Dec 28", day: "Sun", score: 10, color: "bg-red-700", text: "Max Cap", hours: "8am - 10pm", notes: "No relief. Peak holiday week." },
            { date: "Dec 29", day: "Mon", score: 10, color: "bg-red-700", text: "Max Cap", hours: "8am - 10pm", notes: "Historically one of the highest attendance days." },
            { date: "Dec 30", day: "Tue", score: 10, color: "bg-red-700", text: "Max Cap", hours: "8am - 10pm", notes: "Consistent peak crowds." },
            { date: "Dec 31", day: "Wed", score: 10, color: "bg-purple-600", text: "EVE Event", hours: "8am - 2am", notes: "Massive crowds. Park open late for New Year's party." },
            { date: "Jan 1", day: "Thu", score: 10, color: "bg-red-600", text: "Peak", hours: "9am - 10pm", notes: "Rose Parade spillover crowds arrive in afternoon." },
            { date: "Jan 2", day: "Fri", score: 9, color: "bg-red-600", text: "Peak", hours: "8am - 10pm", notes: "Still very heavy due to Rose Bowl visitors extending trips." },
            { date: "Jan 3", day: "Sat", score: 9, color: "bg-orange-700", text: "Very Busy", hours: "8am - 10pm", notes: "Last weekend of holiday break for many schools. Crowds remain high." },
            { date: "Jan 4", day: "Sun", score: 8, color: "bg-orange-600", text: "Busy", hours: "8am - 10pm", notes: "FINAL day of Grinchmas/Holiday events. Good for catching last shows." },
            { date: "Jan 5", day: "Mon", score: 5, color: "bg-green-600", text: "Moderate", hours: "10am - 6pm", notes: "The Golden Day. Schools return. No holiday events, but significantly shorter lines." }
        ];

        // --- State Management ---
        let tripPlan = {}; // Structure: { "Dec 20": { notes: "", checks: [], selected: true/false } }
        let inspectedDate = null; // Holds date string of currently inspected date

        function initState() {
            // 1. Try URL Hash
            if (window.location.hash) {
                try {
                    const hash = window.location.hash.substring(1);
                    const decoded = decodeURIComponent(escape(atob(hash)));
                    tripPlan = JSON.parse(decoded);
                } catch (e) { console.error("Hash parse failed"); }
            } 
            
            // 2. Try Local Storage if empty
            if (Object.keys(tripPlan).length === 0) {
                const saved = localStorage.getItem('universalTripPlan');
                if (saved) {
                    try { tripPlan = JSON.parse(saved); } catch (e) {}
                }
            }
            
            // Default inspect last date
            inspectedDate = calendarData[calendarData.length - 1].date;

            renderCalendar();
            renderItinerary();
            showInspector(calendarData[calendarData.length - 1]);
        }

        function saveState() {
            localStorage.setItem('universalTripPlan', JSON.stringify(tripPlan));
            const jsonString = JSON.stringify(tripPlan);
            const encoded = btoa(unescape(encodeURIComponent(jsonString)));
            history.replaceState(null, null, '#' + encoded);
        }

        // --- Interactions ---
        
        function handleDateClick(dateStr) {
            const dayObj = calendarData.find(d => d.date === dateStr);
            if (!dayObj) return;

            // Set Inspected Date Only
            inspectedDate = dateStr;
            
            // Re-render Calendar (to update inspected border)
            renderCalendar();

            // Show Details in Inspector
            showInspector(dayObj);
        }

        function toggleDateSelection(dateStr) {
             if (!tripPlan[dateStr]) tripPlan[dateStr] = { notes: "", checks: [], selected: false };
            tripPlan[dateStr].selected = !tripPlan[dateStr].selected;
            
            // Save & Re-render
            saveState();
            renderCalendar();
            renderItinerary();
            
            // Re-render inspector to update button text
            const dayObj = calendarData.find(d => d.date === dateStr);
            showInspector(dayObj);
        }

        function updateNote(date, value) {
            if (!tripPlan[date]) tripPlan[date] = { notes: "", checks: [], selected: true };
            tripPlan[date].notes = value;
            saveState();
        }

        function toggleCheck(date, item) {
            if (!tripPlan[date]) tripPlan[date] = { notes: "", checks: [], selected: true };
            if (!tripPlan[date].checks) tripPlan[date].checks = [];
            const idx = tripPlan[date].checks.indexOf(item);
            if (idx > -1) tripPlan[date].checks.splice(idx, 1);
            else tripPlan[date].checks.push(item);
            saveState();
        }

        // --- Renders ---

        function renderCalendar() {
            const grid = document.getElementById('calendar-grid');
            grid.innerHTML = '';

            calendarData.forEach(day => {
                const isSelected = tripPlan[day.date]?.selected;
                const isInspected = day.date === inspectedDate;
                
                const btn = document.createElement('div');
                
                // Base classes
                let classes = `card-shine cursor-pointer relative overflow-hidden rounded-xl border p-3 transition-all duration-200 ${day.color} bg-opacity-20 hover:bg-opacity-30`;
                
                // Visual Logic
                if (isSelected) {
                     // Selected (Added to Itinerary)
                    classes += " selected-date border-blue-400 shadow-[0_0_15px_rgba(96,165,250,0.3)]";
                } else if (isInspected) {
                    // Just Inspected
                    classes += " inspected-date border-white";
                } else {
                    // Default
                    classes += " border-slate-600 hover:border-white";
                }

                btn.className = classes;
                btn.innerHTML = `
                    <div class="flex justify-between items-start mb-2">
                        <span class="font-bold text-md ${isSelected ? 'text-white' : 'text-slate-200'}">${day.date}</span>
                        <span class="text-xs font-mono opacity-75">${day.day}</span>
                    </div>
                    <div class="text-[10px] font-bold uppercase tracking-wider mb-1 opacity-90">${day.text}</div>
                    <div class="w-full bg-slate-900/50 h-1.5 rounded-full overflow-hidden">
                        <div class="h-full ${day.color} brightness-150" style="width: ${day.score * 10}%"></div>
                    </div>
                    ${isSelected ? '<div class="absolute top-1 right-1 text-blue-400"><svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="4" stroke-linecap="round" stroke-linejoin="round"><polyline points="20 6 9 17 4 12"/></svg></div>' : ''}
                `;
                btn.onclick = () => handleDateClick(day.date);
                grid.appendChild(btn);
            });
        }

        function showInspector(data) {
            const detailsPanel = document.getElementById('details-panel');
            let iconColor = data.score >= 9 ? 'text-red-400' : (data.score <= 5 ? 'text-green-400' : 'text-orange-400');
            let recommendation = data.score >= 10 ? 
                '<span class="text-red-300 font-bold"><i data-lucide="alert-octagon" class="inline w-4 h-4 mr-1"></i> Express Pass Mandatory</span>' : 
                (data.score <= 6 ? '<span class="text-green-300 font-bold"><i data-lucide="check-circle-2" class="inline w-4 h-4 mr-1"></i> Great Ride Day</span>' : 
                '<span class="text-blue-300 font-bold"><i data-lucide="check-circle-2" class="inline w-4 h-4 mr-1"></i> Solid Option</span>');

            const isAdded = tripPlan[data.date]?.selected;
            
            // Button Logic
            let actionButton = isAdded 
                ? `<button onclick="toggleDateSelection('${data.date}')" class="w-full py-3 rounded-lg bg-red-900/50 border border-red-500 text-red-200 hover:bg-red-900 hover:text-white transition-colors flex items-center justify-center gap-2 text-sm font-semibold"><i data-lucide="trash" class="w-4 h-4"></i> Remove from Itinerary</button>`
                : `<button onclick="toggleDateSelection('${data.date}')" class="w-full py-3 rounded-lg border-2 border-green-500 text-green-400 hover:bg-green-500/10 hover:text-green-300 transition-all flex items-center justify-center gap-2 text-sm font-bold"><i data-lucide="plus" class="w-4 h-4"></i> Add to Itinerary</button>`;


            detailsPanel.innerHTML = `
                <div class="animate-fadeIn flex flex-col h-full">
                    <div>
                        <div class="flex justify-between items-start mb-4 border-b border-slate-600 pb-4">
                            <div>
                                <h2 class="text-2xl font-bold text-white">${data.date}</h2>
                                <p class="text-slate-400">${data.day}</p>
                            </div>
                            <div class="text-right">
                                <div class="text-2xl font-bold ${iconColor}">${data.score}/10</div>
                                <div class="text-[10px] text-slate-400 uppercase">Crowd Lvl</div>
                            </div>
                        </div>
                        <div class="space-y-4 text-sm">
                            <div>
                                <p class="text-slate-200 leading-snug">${recommendation}</p>
                            </div>
                            <div class="bg-slate-700/30 p-3 rounded-lg border border-slate-600">
                                 <div class="flex items-center gap-2 text-white mb-1">
                                    <i data-lucide="clock" class="w-4 h-4 text-blue-400"></i>
                                    <span class="font-mono font-semibold">${data.hours}</span>
                                 </div>
                                 <p class="text-xs text-slate-400">Operating Hours</p>
                            </div>
                            <div>
                                <p class="text-slate-300 bg-slate-700/20 p-3 rounded-md border border-slate-600/50 italic">
                                    "${data.notes}"
                                </p>
                            </div>
                        </div>
                    </div>
                    
                    <div class="mt-auto pt-6">
                        ${actionButton}
                    </div>
                </div>
            `;
            renderIcons();
        }

        function renderItinerary() {
            const container = document.getElementById('itinerary-list');
            container.innerHTML = '';

            const selectedDates = calendarData.filter(d => tripPlan[d.date]?.selected);

            if (selectedDates.length === 0) {
                container.innerHTML = `
                    <div class="text-center text-slate-500 py-8 opacity-60 flex flex-col items-center gap-2">
                        <i data-lucide="calendar-days" class="w-8 h-8"></i>
                        <span class="text-sm italic">Inspect a date above and click<br>"Add to Itinerary" to start planning.</span>
                    </div>
                `;
                renderIcons();
                return;
            }

            selectedDates.forEach(day => {
                const data = tripPlan[day.date];
                const checklists = [
                    { id: 'mario', label: 'Nintendo' },
                    { id: 'potter', label: 'Potter' },
                    { id: 'grinch', label: 'Grinch' }
                ];

                const div = document.createElement('div');
                div.className = "bg-slate-700/40 border border-slate-600 rounded-xl p-4 animate-fadeIn group";
                // Click on itinerary card also selects that date in inspector
                div.onclick = (e) => {
                    if(e.target.tagName !== 'INPUT' && e.target.tagName !== 'TEXTAREA' && e.target.tagName !== 'BUTTON' && e.target.tagName !== 'svg' && e.target.tagName !== 'path') {
                        handleDateClick(day.date);
                    }
                };
                
                div.innerHTML = `
                    <div class="flex justify-between items-center mb-3">
                        <div class="font-bold text-blue-200 text-lg cursor-pointer hover:text-white transition-colors" onclick="handleDateClick('${day.date}')">${day.date}</div>
                        <button onclick="toggleDateSelection('${day.date}')" class="text-slate-400 hover:text-red-400 transition-colors p-1.5 rounded-md hover:bg-slate-700" title="Remove from itinerary">
                            <div class="w-4 h-4">
                                <svg xmlns="http://www.w3.org/2000/svg" width="100%" height="100%" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="3 6 5 6 21 6"/><path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"/></svg>
                            </div>
                        </button>
                    </div>
                    <div class="flex flex-col gap-3">
                        <div class="flex gap-2 text-xs flex-wrap">
                            ${checklists.map(item => `
                                <label class="checkbox-wrapper flex items-center gap-1.5 cursor-pointer group">
                                    <div class="relative">
                                        <input type="checkbox" class="peer sr-only" 
                                            onchange="toggleCheck('${day.date}', '${item.id}')" 
                                            ${data.checks && data.checks.includes(item.id) ? 'checked' : ''}>
                                        <div class="w-3.5 h-3.5 border border-slate-500 rounded bg-slate-900 transition-colors">
                                            <svg class="w-2.5 h-2.5 text-white absolute top-0.5 left-0.5 hidden pointer-events-none" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="3" d="M5 13l4 4L19 7"></path></svg>
                                        </div>
                                    </div>
                                    <span class="text-slate-400 group-hover:text-slate-200 select-none">${item.label}</span>
                                </label>
                            `).join('')}
                        </div>
                        <textarea 
                            placeholder="Add notes..."
                            class="w-full bg-slate-900/50 border border-slate-600 rounded p-2 text-xs text-white focus:border-blue-500 focus:outline-none transition-colors resize-none h-12"
                            oninput="updateNote('${day.date}', this.value)"
                        >${data.notes || ''}</textarea>
                    </div>
                `;
                container.appendChild(div);
            });
            renderIcons();
        }

        // --- Tab Logic ---
        function switchTab(tabName) {
            ['potter', 'driving', 'events'].forEach(t => {
                document.getElementById(`content-${t}`).classList.add('hidden');
                const btn = document.getElementById(`tab-${t}`);
                // Reset styles
                if(t === 'potter') {
                    btn.classList.remove('bg-slate-700/50', 'text-amber-400', 'border-amber-500');
                    btn.classList.add('text-slate-400', 'hover:text-slate-200');
                } else {
                    btn.classList.remove('bg-slate-700/50', 'text-blue-200', 'border-blue-400');
                    btn.classList.add('text-slate-400', 'hover:text-slate-200');
                }
            });

            document.getElementById(`content-${tabName}`).classList.remove('hidden');
            const activeBtn = document.getElementById(`tab-${tabName}`);
            
            activeBtn.classList.remove('text-slate-400', 'hover:text-slate-200');
            if(tabName === 'potter') {
                activeBtn.classList.add('bg-slate-700/50', 'text-amber-400', 'border-amber-500');
            } else {
                activeBtn.classList.add('bg-slate-700/50', 'text-blue-200', 'border-blue-400');
            }
        }

        function copyShareLink() {
            const url = window.location.href;
            navigator.clipboard.writeText(url).then(() => {
                const toast = document.getElementById('share-toast');
                toast.classList.remove('opacity-0');
                setTimeout(() => toast.classList.add('opacity-0'), 3000);
            });
        }

        // Init
        initState();
    </script>
</body>
</html>
